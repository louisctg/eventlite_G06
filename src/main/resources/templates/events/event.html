<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/default}">
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags" %>
<head>
  <title>Event page</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />
  
<style>
body { margin:0; padding:0; }
#map { position:relative; top:0; bottom:0; width:100%; height: 200px;}
</style>
</head>
<body>
  <div layout:fragment="content">
    <h1>Event</h1>
    
    <div class="container-fluid">
      <div class="row">
        <div class="card" style="font-size:20px;">
          <div class="card-body">
            <p class="card-text"><i class="fa fa-bolt" style="padding-right:10px;"></i><span th:text="${event.name}"/></p>
            <p class="card-text"><i class="fa fa-map-marker" style="padding-right:10px;"></i><a th:href="@{/venues/{id}(id=${event.venue.id})}" th:text="${event.venue.name}"></a></p>
            <p class="card-text"><i class="fa fa-calendar" style="padding-right:10px;"></i><span th:text="${event.date}"/></p>
            <p class="card-text"><i class="fa fa-clock-o" style="padding-right:10px;"></i><span th:text="${event.time}"/></p>
            <p class="card-text"><span th:text="${event.description}"/></p>
            
            <div sec:authorize="hasRole('ADMINISTRATOR')">
            	<p>
              	<a type="submit" class="btn btn-info" th:href="${'/events/update/'+{event.id}}"><i class="glyphicon glyphicon-pencil" aria-hidden="true"></i> Edit</a>
           		</p>
            	
            	<p>
              	<a type="submit" class="btn btn-danger" th:href="${'/events/delete/'+{event.id}}"><i class="glyphicon glyphicon-remove" aria-hidden="true"></i> Delete</a>
            	</p>
            </div>
          
          </div>
        </div>
      </div>
    </div>
    
    <div class="row"><div class="col-lg-12">
          <div id='map'></div>
    </div>
    
	<script th:inline="javascript"> 
		events = [];
	</script>

	<script th:each="e : ${future_events}" th:inline="javascript">
		events.push({'event': [[${e.name}]], 'date': [[${{e.date}}]], 'time': [[${{e.time}}]],
					'venue': [[${e.venue.name}]],'lat': [[${e.venue.lat}]], 'lng': [[${e.venue.lng}]]});
	</script>
	
	<script th:inline="javascript">
		L.mapbox.accessToken = 'pk.eyJ1IjoibWFyY2VsNDF4ZCIsImEiOiJjanRmcGE2bjEwZzFxM3lycm90bXB6cndnIn0.sYaAHPeiuJ5ivfyBE8sCAQ';
		var map =	L.mapbox.map('map').setView([53.46, -2.235], 11)
    								   .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'));

		events.forEach(function(event) {
				L.marker([event.lat, event.lng], {
		    				icon: L.mapbox.marker.icon({
		        				'marker-size': 'large',
		        				'marker-symbol': 'marker',
		        				'marker-color': '#fa0'
		    					})
							}).addTo(map);
						});
		console.log(events);
	</script>
      
  </div>
</body>
</html>